# ğŸ“˜ PlanCraft ê°œë°œ ê°€ì´ë“œ ë° ìŠ¤íƒ€ì¼ ê·œì¹™

> ğŸ“… ìµœì¢… ì—…ë°ì´íŠ¸: 2025-12-29
> ğŸ“ ì„¤ëª…: ì‚¬ìš©ì í”¼ë“œë°±(Code Review)ì„ í†µí•´ ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ëŠ” ê°œë°œ í‘œì¤€ ë¬¸ì„œì…ë‹ˆë‹¤.

## 1. ğŸ¯ í•µì‹¬ ì›ì¹™ (Core Principles)

### 1.1 LangGraph Best Practices ì¤€ìˆ˜
- **State Management**: ë°˜ë“œì‹œ `TypedDict`ë¥¼ ì‚¬ìš©í•˜ê³ , `update_state` í—¬í¼ í•¨ìˆ˜ë¥¼ í†µí•´ ë¶ˆë³€ì„±ì„ ìœ ì§€í•˜ë©° ì—…ë°ì´íŠ¸í•œë‹¤. (Pydantic ê°ì²´ ì§ì ‘ ìˆ˜ì • ê¸ˆì§€)
- **Node ì •ì˜**: ë…¸ë“œëŠ” ìˆœìˆ˜ í•¨ìˆ˜ì— ê°€ê¹ê²Œ ì‘ì„±í•˜ê³ , ì™¸ë¶€ ì˜ì¡´ì„±(LLM ë“±)ì€ ë‚´ë¶€ì—ì„œ importí•˜ê±°ë‚˜ ì£¼ì…ë°›ëŠ”ë‹¤.
- **Interrupt ì²˜ë¦¬**: ì‚¬ìš©ì ê°œì…ì´ í•„ìš”í•œ ê³³ì€ `interrupt`ì™€ `Command` íŒ¨í„´ì„ ëª…í™•íˆ ì‚¬ìš©í•œë‹¤.

### 1.2 í•œê¸€í™” (Localization)
- **Agent ì‘ë‹µ**: ëª¨ë“  ì—ì´ì „íŠ¸ì˜ ìµœì¢… ì¶œë ¥(Markdown)ì€ **í•œêµ­ì–´**ë¡œ ì‘ì„±í•œë‹¤.
- **Log/Comment**: ì£¼ìš” ë¡œì§ì˜ ì£¼ì„ê³¼ ë¡œê·¸ ë©”ì‹œì§€ë„ ê°€ê¸‰ì  í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì—¬ ê°€ë…ì„±ì„ ë†’ì¸ë‹¤.

### 1.3 ì‹œê°„/ë‚ ì§œ ì •í™•ì„± (Time Awareness)
- **Source of Truth**: ë¡œì»¬ ì‹œìŠ¤í…œ ì‹œê°„ ëŒ€ì‹  **ë„¤ì´ë²„ íƒ€ì„ ì„œë²„**(`utils.time_context`)ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.
- **í”„ë¡¬í”„íŠ¸ ì£¼ì…**: Writer, Structurer ë“± ì¼ì •ì„ ë‹¤ë£¨ëŠ” ì—ì´ì „íŠ¸ì—ê²ŒëŠ” ë°˜ë“œì‹œ í˜„ì¬ ë‚ ì§œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì£¼ì…í•œë‹¤.

---

## 2. ğŸ’» ì½”ë”© ì»¨ë²¤ì…˜ (Coding Conventions)

### 2.1 Python ìŠ¤íƒ€ì¼
- **Type Hinting**: ëª¨ë“  í•¨ìˆ˜ ì¸ìì™€ ë°˜í™˜ê°’ì— ëª…ì‹œì ì¸ íƒ€ì… íŒíŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤.
- **Docstring**: Google Style Docstringì„ ì‚¬ìš©í•˜ì—¬ í•¨ìˆ˜ ì—­í• , Args, Returnsë¥¼ ëª…ì‹œí•œë‹¤.
- **Import ìˆœì„œ**: í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ â†’ ì„œë“œíŒŒí‹°(LangChain ë“±) â†’ ë‚´ë¶€ ëª¨ë“ˆ ìˆœìœ¼ë¡œ ì •ë ¬í•œë‹¤.

### 2.2 ì—ëŸ¬ ì²˜ë¦¬
- **Graceful Failure**: ê°œë³„ ë…¸ë“œì˜ ì—ëŸ¬ê°€ ì „ì²´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì¤‘ë‹¨ì‹œí‚¤ì§€ ì•Šë„ë¡ `try-except` ë˜ëŠ” ë°ì½”ë ˆì´í„°(`@handle_node_error`)ë¥¼ ì‚¬ìš©í•œë‹¤.
- **Fallback**: LLM í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ê°’ì´ë‚˜ ì¬ì‹œë„ ë¡œì§ì„ ë§ˆë ¨í•œë‹¤.

### 2.3 í…ŒìŠ¤íŠ¸ (Testing)
- **Mocking Strategy**: ì™¸ë¶€ API(LLM, ì›¹ ê²€ìƒ‰)ëŠ” `unittest.mock`ì„ ì‚¬ìš©í•˜ì—¬ ì² ì €íˆ ê²©ë¦¬(Mocking) í…ŒìŠ¤íŠ¸í•œë‹¤.
- **Integration Test**: ì‹¤ì œ ì›Œí¬í”Œë¡œìš° íë¦„ì„ ê²€ì¦í•˜ëŠ” í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ë³„ë„ë¡œ ìœ ì§€í•œë‹¤.

---

## 3. ğŸš« ì£¼ì˜ ì‚¬í•­ (Anti-Patterns)
- **ìˆœí™˜ ì°¸ì¡°(Circular Import)**: `workflow.py`ì™€ ë‹¤ë¥¸ ëª¨ë“ˆ ê°„ì˜ ìˆœí™˜ ì°¸ì¡°ë¥¼ ì£¼ì˜í•œë‹¤. í•¨ìˆ˜ ë‚´ë¶€ importë¡œ í•´ê²°í•œë‹¤.
- **í•˜ë“œì½”ë”©**: í”„ë¡¬í”„íŠ¸ë‚˜ ì„¤ì •ê°’ì€ ì½”ë“œ ë‚´ì— í•˜ë“œì½”ë”©í•˜ì§€ ì•Šê³  ë³„ë„ íŒŒì¼(`prompts/`, `config.py`)ë¡œ ë¶„ë¦¬í•œë‹¤.
- **ë¬´í•œ ë£¨í”„**: `while` ë¬¸ ëŒ€ì‹  LangGraphì˜ `recursion_limit`ê³¼ ëª…ì‹œì ì¸ ì¹´ìš´í„°(`restart_count`)ë¥¼ ì‚¬ìš©í•œë‹¤.

---

## 4. ğŸ“ í”¼ë“œë°± ë¡œê·¸ (Revision History)

| ë‚ ì§œ | í”¼ë“œë°± ë‚´ìš© | ë°˜ì˜ ë‚´ì—­ |
|------|-------------|-----------|
| 2025-12-29 | RemainingSteps ë²„ì „ í˜¸í™˜ì„± ë¬¸ì œ | `Annotated[int, RemainingSteps]` ëŒ€ì‹  `int` ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½ |
| 2025-12-29 | ë‚ ì§œ/ì‹œê°„ ë¶€ì •í™• ì´ìŠˆ | `utils/time_context.py` ë„ì… ë° ë„¤ì´ë²„ ì„œë²„ ì‹œê°„ ì—°ë™ |
| 2025-12-29 | ìˆœí™˜ ì°¸ì¡°ë¡œ ì¸í•œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ | í•¨ìˆ˜ ì •ì˜ ìœ„ì¹˜ ì´ë™ ë° ì „ì—­ í•¨ìˆ˜í™” |

---

## 5. ğŸ­ ì‹¤ì „ ë°°í¬ ê°€ì´ë“œë¼ì¸ (Production Guidelines)

> Code Review Agent í”¼ë“œë°± ê¸°ë°˜ (2025-12-29)

### 5.1 Persistence Strategy
- **Dev/Test**: `MemorySaver` ì‚¬ìš© (ì†ë„, ê°„í¸í•¨)
- **Production**: `PostgresSaver` ë˜ëŠ” `RedisSaver` í•„ìˆ˜ ì‚¬ìš© (ì¥ì•  ë³µêµ¬, ì˜ì†ì„±)
- **Config**: í™˜ê²½ ë³€ìˆ˜(`APP_ENV`)ì— ë”°ë¼ Checkpointerë¥¼ ë™ì ìœ¼ë¡œ êµì²´í•˜ëŠ” Factory íŒ¨í„´ ì ìš©

### 5.2 Input Validation Pattern
- Human Interrupt ê°’ì€ **ë°˜ë“œì‹œ ê²€ì¦**í•´ì•¼ í•œë‹¤.
- ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë…¸ë“œ ë‚´ `while True` ë£¨í”„ë¥¼ í†µí•´ ë‹¤ì‹œ `interrupt`ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¬ì…ë ¥ì„ ìš”êµ¬í•œë‹¤.

### 5.3 Scalability
- **Resume íŒ¨í„´**: ë‹¨ìˆœ ê°’ ì „ë‹¬ì„ ë„˜ì–´ `Command(goto="node_name")` íŒ¨í„´ì„ í™œìš©í•˜ì—¬ ë‹¤ì–‘í•œ ë¶„ê¸° ì²˜ë¦¬ë¥¼ ì§€ì›í•œë‹¤.
- **Observability**: ë°°í¬ ì‹œ LangSmith Tracingì„ **Always On**ìœ¼ë¡œ ì„¤ì •í•œë‹¤.
