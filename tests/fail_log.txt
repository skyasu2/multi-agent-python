============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-9.0.2, pluggy-1.6.0 -- C:\Python313\python.exe
cachedir: .pytest_cache
rootdir: D:\개인\ai ax\pro
plugins: anyio-4.9.0, langsmith-0.5.1
collecting ... collected 184 items / 174 deselected / 10 selected
run-last-failure: rerun previous 10 failures

tests/test_time_travel.py::TestTimeTravelMock::test_get_state_at_step FAILED [ 10%]
tests/test_time_travel.py::TestTimeTravelMock::test_compare_states FAILED [ 20%]
tests/test_ui_integration.py::TestInterruptPayloadCreation::test_option_type_payload FAILED [ 30%]
tests/test_ui_integration.py::TestInterruptPayloadCreation::test_form_type_payload FAILED [ 40%]
tests/test_ui_integration.py::TestInterruptPayloadCreation::test_payload_json_serializable FAILED [ 50%]
tests/test_ui_integration.py::TestInterruptUIData::test_option_ui_data FAILED [ 60%]
tests/test_ui_integration.py::TestInterruptUIData::test_error_message_in_payload FAILED [ 70%]
tests/test_ui_integration.py::TestInterruptUIData::test_retry_count_tracking FAILED [ 80%]
tests/test_ui_integration.py::TestMultipleInterruptScenarios::test_sequential_interrupts FAILED [ 90%]
tests/test_ui_integration.py::TestMultipleInterruptScenarios::test_max_retry_exceeded FAILED [100%]

================================== FAILURES ===================================
__________________ TestTimeTravelMock.test_get_state_at_step __________________

self = <test_time_travel.TestTimeTravelMock object at 0x0000021EB1516060>
time_travel = <utils.time_travel.TimeTravel object at 0x0000021EB1A77CB0>

    def test_get_state_at_step(self, time_travel):
        """특정 단계 상태 조회 테스트"""
        snapshot = time_travel.get_state_at_step(0)
        assert snapshot is not None
        assert snapshot.step_name == "format"
    
        snapshot = time_travel.get_state_at_step(1)
        assert snapshot is not None
>       assert snapshot.step_name == "write"
E       AssertionError: assert 'analyze' == 'write'
E         
E         - write
E         + analyze

tests\test_time_travel.py:163: AssertionError
___________________ TestTimeTravelMock.test_compare_states ____________________

self = <test_time_travel.TestTimeTravelMock object at 0x0000021EB1621FD0>
time_travel = <utils.time_travel.TimeTravel object at 0x0000021EB1AD5E50>

    def test_compare_states(self, time_travel):
        """상태 비교 테스트"""
        diff = time_travel.compare_states(step1=0, step2=3)
>       assert "current_step" in diff
E       AssertionError: assert 'current_step' in {'error': '하나 이상의 스냅샷을 찾을 수 없습니다'}

tests\test_time_travel.py:173: AssertionError
____________ TestInterruptPayloadCreation.test_option_type_payload ____________

self = <test_ui_integration.TestInterruptPayloadCreation object at 0x0000021EB16CCE10>
hitl_state = {'agreed_action_items': [], 'analysis': None, 'chat_history': [], 'chat_summary': None, ...}

    def test_option_type_payload(self, hitl_state):
        """옵션 선택형 페이로드 생성"""
>       payload = create_option_interrupt(hitl_state)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: create_option_interrupt() missing 1 required positional argument: 'interrupt_id'

tests\test_ui_integration.py:52: TypeError
_____________ TestInterruptPayloadCreation.test_form_type_payload _____________

self = <test_ui_integration.TestInterruptPayloadCreation object at 0x0000021EB16CD6D0>
base_state = {'agreed_action_items': [], 'analysis': None, 'chat_history': [], 'chat_summary': None, ...}

    def test_form_type_payload(self, base_state):
        """폼 입력형 페이로드 생성"""
        state = update_state(
            base_state,
            need_more_info=True,
            option_question="추가 정보를 입력해주세요",
            options=[],
            input_schema_name="UserInputSchema"
        )
    
>       payload = create_option_interrupt(state)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: create_option_interrupt() missing 1 required positional argument: 'interrupt_id'

tests\test_ui_integration.py:69: TypeError
_________ TestInterruptPayloadCreation.test_payload_json_serializable _________

self = <test_ui_integration.TestInterruptPayloadCreation object at 0x0000021EB15162C0>
hitl_state = {'agreed_action_items': [], 'analysis': None, 'chat_history': [], 'chat_summary': None, ...}

    def test_payload_json_serializable(self, hitl_state):
        """페이로드 JSON 직렬화 가능 여부"""
        import json
    
>       payload = create_option_interrupt(hitl_state)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: create_option_interrupt() missing 1 required positional argument: 'interrupt_id'

tests\test_ui_integration.py:78: TypeError
___________________ TestInterruptUIData.test_option_ui_data ___________________

self = <test_ui_integration.TestInterruptUIData object at 0x0000021EB16CDA90>
hitl_state = {'agreed_action_items': [], 'analysis': None, 'chat_history': [], 'chat_summary': None, ...}

    def test_option_ui_data(self, hitl_state):
        """옵션 UI 렌더링 데이터"""
>       payload = create_option_interrupt(hitl_state)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: create_option_interrupt() missing 1 required positional argument: 'interrupt_id'

tests\test_ui_integration.py:161: TypeError
______________ TestInterruptUIData.test_error_message_in_payload ______________

self = <test_ui_integration.TestInterruptUIData object at 0x0000021EB16CDBD0>
base_state = {'agreed_action_items': [], 'analysis': None, 'chat_history': [], 'chat_summary': None, ...}

    def test_error_message_in_payload(self, base_state):
        """에러 메시지 포함된 페이로드"""
        state = update_state(
            base_state,
            need_more_info=True,
            option_question="다시 입력해주세요",
            options=[{"title": "재시도", "description": "다시 시도"}],
            error_message="입력값이 유효하지 않습니다"
        )
    
>       payload = create_option_interrupt(state)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: create_option_interrupt() missing 1 required positional argument: 'interrupt_id'

tests\test_ui_integration.py:183: TypeError
________________ TestInterruptUIData.test_retry_count_tracking ________________

self = <test_ui_integration.TestInterruptUIData object at 0x0000021EB1516D70>
hitl_state = {'agreed_action_items': [], 'analysis': None, 'chat_history': [], 'chat_summary': None, ...}

    def test_retry_count_tracking(self, hitl_state):
        """재시도 횟수 추적"""
        state = update_state(hitl_state, retry_count=2)
    
>       payload = create_option_interrupt(state)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: create_option_interrupt() missing 1 required positional argument: 'interrupt_id'

tests\test_ui_integration.py:193: TypeError
__________ TestMultipleInterruptScenarios.test_sequential_interrupts __________

self = <test_ui_integration.TestMultipleInterruptScenarios object at 0x0000021EB16CDE50>
base_state = {'agreed_action_items': [], 'analysis': None, 'chat_history': [], 'chat_summary': None, ...}

    def test_sequential_interrupts(self, base_state):
        """연속적인 인터럽트 처리"""
        # 첫 번째 인터럽트
        state1 = update_state(
            base_state,
            need_more_info=True,
            option_question="질문 1",
            options=[{"title": "A", "description": "옵션 A"}]
        )
    
>       payload1 = create_option_interrupt(state1)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: create_option_interrupt() missing 1 required positional argument: 'interrupt_id'

tests\test_ui_integration.py:240: TypeError
___________ TestMultipleInterruptScenarios.test_max_retry_exceeded ____________

self = <test_ui_integration.TestMultipleInterruptScenarios object at 0x0000021EB16CDF90>
hitl_state = {'agreed_action_items': [], 'analysis': None, 'chat_history': [], 'chat_summary': None, ...}

    def test_max_retry_exceeded(self, hitl_state):
        """최대 재시도 횟수 초과"""
        from utils.settings import settings
    
        state = update_state(hitl_state, retry_count=settings.HITL_MAX_RETRIES)
    
        # 최대 재시도 도달 시에도 페이로드 생성 가능
>       payload = create_option_interrupt(state)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: create_option_interrupt() missing 1 required positional argument: 'interrupt_id'

tests\test_ui_integration.py:264: TypeError
============================== warnings summary ===============================
utils\schemas.py:26
utils\schemas.py:26
  D:\개인\ai ax\pro\utils\schemas.py:26: DeprecationWarning: Importing FieldValidationInfo from `pydantic` is deprecated. This feature is either no longer supported, or is not public.
    from pydantic import BaseModel, Field, field_validator, model_validator, ValidationInfo, FieldValidationInfo

C:\Users\skyasu-pc\AppData\Roaming\Python\Python313\site-packages\pydantic_core\core_schema.py:4324
C:\Users\skyasu-pc\AppData\Roaming\Python\Python313\site-packages\pydantic_core\core_schema.py:4324
  C:\Users\skyasu-pc\AppData\Roaming\Python\Python313\site-packages\pydantic_core\core_schema.py:4324: DeprecationWarning: `FieldValidationInfo` is deprecated, use `ValidationInfo` instead.
    warnings.warn(msg, DeprecationWarning, stacklevel=1)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_time_travel.py::TestTimeTravelMock::test_get_state_at_step
FAILED tests/test_time_travel.py::TestTimeTravelMock::test_compare_states - A...
FAILED tests/test_ui_integration.py::TestInterruptPayloadCreation::test_option_type_payload
FAILED tests/test_ui_integration.py::TestInterruptPayloadCreation::test_form_type_payload
FAILED tests/test_ui_integration.py::TestInterruptPayloadCreation::test_payload_json_serializable
FAILED tests/test_ui_integration.py::TestInterruptUIData::test_option_ui_data
FAILED tests/test_ui_integration.py::TestInterruptUIData::test_error_message_in_payload
FAILED tests/test_ui_integration.py::TestInterruptUIData::test_retry_count_tracking
FAILED tests/test_ui_integration.py::TestMultipleInterruptScenarios::test_sequential_interrupts
FAILED tests/test_ui_integration.py::TestMultipleInterruptScenarios::test_max_retry_exceeded
=============== 10 failed, 174 deselected, 4 warnings in 1.57s ================
