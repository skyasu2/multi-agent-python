# =============================================================================
# PlanCraft Agent - Docker Compose
# Multi-Agent AI 기획서 생성 서비스
# =============================================================================

version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # PlanCraft 메인 서비스
  # ---------------------------------------------------------------------------
  plancraft:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: plancraft-agent
    restart: unless-stopped
    ports:
      - "8501:8501"
    # 환경변수는 .env.local 파일에서 로드 (API 키는 절대 직접 입력 금지!)
    env_file:
      - .env.local
    environment:
      # 애플리케이션 설정만 (시크릿 제외)
      - PYTHONPATH=/app
    volumes:
      # 로그 및 출력 영속화
      - ./logs:/app/logs
      - ./outputs:/app/outputs
      # RAG 인덱스 영속화 (선택)
      - ./rag/faiss_index:/app/rag/faiss_index
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - plancraft-network

# -----------------------------------------------------------------------------
# 네트워크 정의
# -----------------------------------------------------------------------------
networks:
  plancraft-network:
    driver: bridge

# -----------------------------------------------------------------------------
# 볼륨 정의 (영속 데이터용)
# -----------------------------------------------------------------------------
volumes:
  plancraft-logs:
    driver: local
  plancraft-outputs:
    driver: local
